<h2><%= @folder.name %></h2>

<hr>

<%= form_with url: bulk_delete_stored_files_path, method: :delete do %>

  <!-- Select All Checkbox -->
  <div style="margin-bottom: 12px;">
    <label>
      <%= check_box_tag "select_all", "", false, id: "select_all" %>
      Select All
    </label>
  </div>

  <% @folder.stored_files.each do |file| %>
    <article class="mb-3" style="padding: 10px; border-bottom: 1px solid #ddd;">

      <%= check_box_tag "file_ids[]", file.id, false, class: "file-checkbox" %>

      <strong style="margin-left: 8px;">
        <% if file.uploaded_file.attached? %>
          <%= file.uploaded_file.filename %>
        <% else %>
          <%= file.file_name %>
        <% end %>
      </strong>

      <% if file.uploaded_file.attached? %>
        <div>
          <%= link_to "Download", rails_blob_path(file.uploaded_file, disposition: "attachment") %>
        </div>
      <% end %>

    </article>
  <% end %>

  <%= submit_tag "Delete Selected", class: "contrast outline", style: "margin-top: 20px;" %>

<% end %>

<hr>

<%= link_to "Upload New File", new_stored_file_path(folder_id: @folder.id), class: "button" %>

<script>
  document.addEventListener("turbo:load", () => {
    const selectAll = document.getElementById("select_all");
    const checkboxes = document.querySelectorAll(".file-checkbox");

    selectAll.addEventListener("change", () => {
      checkboxes.forEach(cb => cb.checked = selectAll.checked);
    });
  });
</script>
